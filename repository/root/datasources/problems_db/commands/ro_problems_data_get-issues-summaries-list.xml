<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE command SYSTEM "../../../../dtds/script-dao-commands.dtd">
<command name="ro.problems.data.get-issues-summaries-list" type="SQL.QUERY">
         <parameters>
                     <parameter name="idsList" />
                     <parameter name="sortList" />
               </parameters>
      <script>
      select 
i.id
,i.title
,i.insert_date
,sum(case evp.vote
	when 'y' then 1
	else 0
	end) pro_votes
,sum(case evp.vote
	when 'n' then 1
	else 0
	end) opposed_votes
,count(distinct(s.id)) solutions	
,count(distinct(c.id)) comments
,max(c.insert_date) last_comment_insert_date	
from entities i
left outer join entities_votes evp on (i.id=evp.entity_id )
left outer join entities c on (i.id = c.parent_entity_id and c.entity_type_id=(select id from entity_types where type='COMMENT'))
left outer join entities s on (i.id = s.parent_entity_id and s.entity_type_id=(select id from entity_types where type='SOLUTION'))
where
i.entity_type_id=(select id from entity_types where type='ISSUE')
and i.id in ( $idsList )
group by i.id,i.title,i.insert_date
order by $sortList
   </script>
</command>