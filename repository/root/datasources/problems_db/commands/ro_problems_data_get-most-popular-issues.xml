<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE command SYSTEM "../../../../dtds/script-dao-commands.dtd">
<command name="ro.problems.data.get-most-popular-issues" type="SQL.QUERY">
         <parameters>
                     <parameter name="pageNumber" />
                     <parameter name="itemsOnPage" />
               </parameters>
      <script>
      select id from entities, entities_votes ev
where entity_type_id=(select id from entity_types where type='ISSUE')
and id = ev.entity_id
and ev.vote='y'
and (select count(a.vote) from entities_votes a where a.entity_id=id and a.vote='n')*1.0
/ (select count(a.vote) from entities_votes a where a.entity_id=id and a.vote='y')*1.0 &lt; (select number_value from application_config where param_name='votes_ratio_for_most_popular_issue')
group by id
order by count(ev.vote) desc
limit $itemsOnPage offset $itemsOnPage * ( $pageNumber - 1 )
   </script>
</command>
