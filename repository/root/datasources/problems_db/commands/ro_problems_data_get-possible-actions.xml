<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE command SYSTEM "../../../../dtds/script-dao-commands.dtd">
<command name="ro.problems.data.get-possible-actions" type="SQL.QUERY">
         <parameters>
                     <parameter name="entityId" />
                     <parameter name="userTypes" />
               </parameters>
      <script>
      select 
a.action
,a.name action_name
,a.params action_params
,at.type action_type
, atg.target action_target
, ut.type user_type
, et.type target_entity_type 
from action_strategies acts
,actions a
,action_types at
,user_types ut
,action_targets atg
,entity_types et
where
(
complex_entity_type_id = ( select complex_entity_type_id from entities where id= $entityId )
or
complex_entity_type_id = (select id from complex_entity_type  where complex_type in ('*'))
)
and user_type_id in(
(select id from user_types  where type in('*','$userTypes'))
)
and acts.action_id=a.id
and a.action_type_id=at.id
and acts.user_type_id = ut.id
and acts.action_target_id=atg.id
and acts.entity_type_id=et.id
order by acts.complex_entity_type_id,acts.order_index
 
   </script>
</command>